CorreÃ§Ã£o da LÃ³gica de DeterminaÃ§Ã£o da Zona e PreÃ§o no EndereÃ§o do Cliente

Atualmente, na tela do cliente /events/{id}/address, o sistema determina a zona de CEP do endereÃ§o e o preÃ§o de entrega correspondente.
As regras de preÃ§os vÃªm de duas tabelas:

cep_zones â†’ contÃ©m todas as zonas ativas, com seus preÃ§os padrÃ£o.

event_cep_zone_prices â†’ contÃ©m os preÃ§os personalizados por evento (opcional).

ğŸ“Œ Problema atual
O algoritmo hoje busca primeiro os preÃ§os personalizados na tabela event_cep_zone_prices.

Se a zona real do CEP nÃ£o tiver preÃ§o personalizado, mas o fallback (Ãºltima prioridade) tiver um preÃ§o configurado, o sistema estÃ¡ escolhendo o fallback.

Isso Ã© incorreto, porque o CEP deveria continuar na zona em que realmente se encaixa (ex: prioridade 2) e usar o preÃ§o padrÃ£o da tabela cep_zones, em vez de â€œcairâ€ para o fallback.

Ou seja:

CEP encaixa na zona 2.

Evento nÃ£o tem preÃ§o personalizado para a zona 2 â†’ deveria usar o preÃ§o padrÃ£o da cep_zones.

Mas, como o fallback (zona 4) tem preÃ§o personalizado, o sistema estÃ¡ atribuindo o CEP ao fallback e aplicando esse preÃ§o incorretamente.

ğŸ“Œ Regras desejadas (correÃ§Ã£o):

IdentificaÃ§Ã£o da zona

O CEP deve ser classificado sempre pela primeira zona ativa encontrada pela ordem de prioridade (1 â†’ N).

O fallback (Ãºltima prioridade) sÃ³ deve ser considerado se o CEP nÃ£o se encaixar em nenhuma outra zona anterior.

DeterminaÃ§Ã£o do preÃ§o correto

Verificar se o evento possui um preÃ§o personalizado para a zona encontrada (event_cep_zone_prices).

Se sim â†’ usar o preÃ§o personalizado.

Se nÃ£o â†’ usar o preÃ§o padrÃ£o da zona da tabela cep_zones.

Nunca substituir por preÃ§o personalizado do fallback se o CEP jÃ¡ se encaixou em outra zona de maior prioridade.

ğŸ“Œ Objetivo da correÃ§Ã£o

Garantir que o preÃ§o aplicado ao cliente sempre respeite a zona correta e ativa do CEP.

Usar fallback apenas quando necessÃ¡rio, sem sobrepor zonas mais especÃ­ficas.

Alinhar a tela do cliente (/events/{id}/address) com a lÃ³gica de zonas usada em relatÃ³rios, cupons e filtros.