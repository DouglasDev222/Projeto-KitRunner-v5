Prompt Estruturado

Quero que voc√™ adicione uma nova funcionalidade de integra√ß√£o com WhatsApp ao meu sistema de gerenciamento de pedidos.
Minha aplica√ß√£o j√° possui fluxo de pedidos, status, envio de e-mails autom√°ticos e webhook de pagamento.

Objetivo

Adicionar envio autom√°tico de mensagem de confirma√ß√£o de pedido via WhatsApp ap√≥s o webhook de pagamento aprovado.

API Externa de WhatsApp (j√° pronta)

Enviar mensagem

POST http://91.108.126.63:5000/send-message

Headers:

Authorization: Bearer 12345678

Content-Type: application/json

Body:

{
  "number": "558387606350",
  "message": "Mensagem formatada com *negrito* e emojis üòäüöÄ"
}


Response:

{
  "status": "success",
  "jobId": "2",
  "description": "Mensagem adicionada √† fila para envio."
}


Obter QR Code de conex√£o

GET http://91.108.126.63:5000/qrcode

Se conectado:

{
  "status": "error",
  "description": "J√° conectado ao WhatsApp ou QR Code n√£o necess√°rio no momento."
}


Se n√£o conectado: retorna um Base64 PNG com QR Code.

Requisitos da Nova Funcionalidade

Admin ‚Äì Aba WhatsApp

Submenu no painel do admin chamado "WhatsApp".

Telas:

Conex√£o: Exibir QR Code ou status "J√° conectado".

Template da mensagem: Editor de texto (suportar placeholders como {{cliente}}, {{evento}}, {{kits}}, {{data_entrega}}).

Hist√≥rico: Listagem de mensagens enviadas (pedido, cliente, n√∫mero, status, jobId, data/hora).

Banco de Dados
Criar tabela whatsapp_messages com os campos:

id (pk)

pedido_id (fk)

cliente_nome

numero

mensagem

status (success/error)

jobId (string da API)

criado_em (timestamp)

Webhook de Pagamento

Ao receber confirma√ß√£o de pagamento aprovado:

Buscar pedido, cliente, evento, kits e data prevista de entrega.

Montar mensagem baseada no template configurado no admin.

Substituir placeholders ({{cliente}}, {{evento}}, {{kits}}, {{data_entrega}}).

Enviar POST para API /send-message.

Registrar no banco em whatsapp_messages.

Template de Mensagem (exemplo inicial)

Ol√°, *{{cliente}}*!  
Confirmamos sua solicita√ß√£o de *[Retirada do Kit] {{evento}}*.

Voc√™ solicitou a retirada de *{{qtd_kits}}* kits para os seguintes atletas:

{{lista_kits}}

Vamos retirar seu kit, previs√£o de entrega √© para amanh√£ dia {{data_entrega}}.  
Logo mais entraremos em contato e faremos a entrega no endere√ßo informado no pedido.  

Qualquer d√∫vida, estamos √† disposi√ß√£o.  

O que eu quero que voc√™ fa√ßa

Criar as rotas e controladores para integra√ß√£o WhatsApp.

Criar a tabela whatsapp_messages e l√≥gica de grava√ß√£o.

Adicionar o submenu no painel admin com:

Conex√£o (QR Code)

Editor de template

Hist√≥rico de mensagens enviadas

Modificar o fluxo do webhook de pagamento para disparar a mensagem automaticamente.

Garantir que a mensagem seja montada a partir do template edit√°vel e enviada com placeholders substitu√≠dos.